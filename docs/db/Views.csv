table_schema,view_name,view_sql
extensions,pg_stat_statements," SELECT userid,
    dbid,
    toplevel,
    queryid,
    query,
    plans,
    total_plan_time,
    min_plan_time,
    max_plan_time,
    mean_plan_time,
    stddev_plan_time,
    calls,
    total_exec_time,
    min_exec_time,
    max_exec_time,
    mean_exec_time,
    stddev_exec_time,
    rows,
    shared_blks_hit,
    shared_blks_read,
    shared_blks_dirtied,
    shared_blks_written,
    local_blks_hit,
    local_blks_read,
    local_blks_dirtied,
    local_blks_written,
    temp_blks_read,
    temp_blks_written,
    shared_blk_read_time,
    shared_blk_write_time,
    local_blk_read_time,
    local_blk_write_time,
    temp_blk_read_time,
    temp_blk_write_time,
    wal_records,
    wal_fpi,
    wal_bytes,
    jit_functions,
    jit_generation_time,
    jit_inlining_count,
    jit_inlining_time,
    jit_optimization_count,
    jit_optimization_time,
    jit_emission_count,
    jit_emission_time,
    jit_deform_count,
    jit_deform_time,
    stats_since,
    minmax_stats_since
   FROM pg_stat_statements(true) pg_stat_statements(userid, dbid, toplevel, queryid, query, plans, total_plan_time, min_plan_time, max_plan_time, mean_plan_time, stddev_plan_time, calls, total_exec_time, min_exec_time, max_exec_time, mean_exec_time, stddev_exec_time, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, shared_blk_read_time, shared_blk_write_time, local_blk_read_time, local_blk_write_time, temp_blk_read_time, temp_blk_write_time, wal_records, wal_fpi, wal_bytes, jit_functions, jit_generation_time, jit_inlining_count, jit_inlining_time, jit_optimization_count, jit_optimization_time, jit_emission_count, jit_emission_time, jit_deform_count, jit_deform_time, stats_since, minmax_stats_since);"
extensions,pg_stat_statements_info," SELECT dealloc,
    stats_reset
   FROM pg_stat_statements_info() pg_stat_statements_info(dealloc, stats_reset);"
public,author_medal_totals," SELECT p.author_id,
    sum(s.bronze)::integer AS bronze,
    sum(s.silver)::integer AS silver,
    sum(s.gold)::integer AS gold
   FROM posts p
     JOIN post_reaction_summary s ON s.post_id = p.id
  GROUP BY p.author_id;"
public,comment_like_summary," SELECT comment_id,
    count(*)::integer AS likes_count
   FROM comment_likes
  GROUP BY comment_id;"
public,community_notes_feed," SELECT n.id,
    n.user_id,
    n.body,
    n.created_at,
    n.updated_at,
    p.username,
    COALESCE(NULLIF(p.display_name, ''::text), p.username) AS display_name,
    p.avatar_url
   FROM community_notes n
     JOIN profiles p ON p.id = n.user_id;"
public,inbox_threads," WITH my_convs AS (
         SELECT cm.conversation_id
           FROM conversation_members cm
          WHERE cm.user_id = auth.uid()
        ), other_side AS (
         SELECT cm.conversation_id,
            cm.user_id AS other_user_id
           FROM conversation_members cm
             JOIN my_convs mc ON mc.conversation_id = cm.conversation_id
          WHERE cm.user_id <> auth.uid()
        ), last_msg AS (
         SELECT DISTINCT ON (m.conversation_id) m.conversation_id,
            m.body AS last_body,
            m.created_at AS last_created_at
           FROM messages m
             JOIN my_convs mc ON mc.conversation_id = m.conversation_id
          ORDER BY m.conversation_id, m.created_at DESC
        ), unread AS (
         SELECT m.conversation_id,
            count(*)::integer AS unread_count
           FROM messages m
             JOIN my_convs mc ON mc.conversation_id = m.conversation_id
          WHERE m.sender_id <> auth.uid() AND m.read_at IS NULL
          GROUP BY m.conversation_id
        )
 SELECT o.conversation_id,
    o.other_user_id,
    p.username AS other_username,
    COALESCE(NULLIF(TRIM(BOTH FROM p.display_name), ''::text), p.username) AS other_display_name,
    p.avatar_url AS other_avatar_url,
    lm.last_body,
    lm.last_created_at,
    COALESCE(u.unread_count, 0) AS unread_count
   FROM other_side o
     JOIN profiles p ON p.id = o.other_user_id
     LEFT JOIN last_msg lm ON lm.conversation_id = o.conversation_id
     LEFT JOIN unread u ON u.conversation_id = o.conversation_id;"
public,post_engagement_posts," SELECT id AS post_id,
    title,
    excerpt,
    slug,
    channel_id,
    author_id,
    subcategory_tag_id,
    status,
    created_at,
    published_at,
    cover_image_url,
    (( SELECT count(*) AS count
           FROM comments c
          WHERE c.post_id = p.id))::integer AS comments_count,
    (( SELECT COALESCE(sum(r.votes), 0::bigint) AS ""coalesce""
           FROM post_reaction_summary r
          WHERE r.post_id = p.id))::integer AS reactions_count,
    (( SELECT COALESCE(sum(r.gold + r.silver + r.bronze), 0::bigint) AS ""coalesce""
           FROM post_reaction_summary r
          WHERE r.post_id = p.id))::integer AS medals_count
   FROM posts p;"
public,post_engagement_summary," SELECT p.id AS post_id,
    COALESCE(c.comments_count, 0) AS comments_count,
    COALESCE(r.reactions_count, 0) AS reactions_count,
    COALESCE(r.gold, 0) AS gold,
    COALESCE(r.silver, 0) AS silver,
    COALESCE(r.bronze, 0) AS bronze,
    COALESCE(r.gold, 0) * 3 + COALESCE(r.silver, 0) * 2 + COALESCE(r.bronze, 0) AS medals_score
   FROM posts p
     LEFT JOIN ( SELECT comments.post_id,
            count(*)::integer AS comments_count
           FROM comments
          GROUP BY comments.post_id) c ON c.post_id = p.id
     LEFT JOIN ( SELECT post_reaction_summary.post_id,
            sum(COALESCE(post_reaction_summary.votes, 0))::integer AS reactions_count,
            sum(COALESCE(post_reaction_summary.gold, 0))::integer AS gold,
            sum(COALESCE(post_reaction_summary.silver, 0))::integer AS silver,
            sum(COALESCE(post_reaction_summary.bronze, 0))::integer AS bronze
           FROM post_reaction_summary
          GROUP BY post_reaction_summary.post_id) r ON r.post_id = p.id;"
public,post_medals_all_time," SELECT p.id AS post_id,
    (pendemic_medals_reset4_post_display(count(v.*)::integer)).gold AS gold,
    (pendemic_medals_reset4_post_display(count(v.*)::integer)).silver AS silver,
    (pendemic_medals_reset4_post_display(count(v.*)::integer)).bronze AS bronze,
    count(v.*)::integer AS votes_total
   FROM posts p
     LEFT JOIN post_reaction_votes v ON v.post_id = p.id
  WHERE p.deleted_at IS NULL
  GROUP BY p.id;"
public,post_reaction_summary," WITH base AS (
         SELECT v.post_id,
            v.reaction_key,
            count(*)::integer AS votes,
            floor(count(*)::numeric / 5.0)::integer AS bronze
           FROM post_reaction_votes v
          GROUP BY v.post_id, v.reaction_key
        ), silver_calc AS (
         SELECT base.post_id,
            base.reaction_key,
            base.votes,
            base.bronze,
            floor(base.bronze::numeric / 3.0)::integer AS silver
           FROM base
        ), gold_calc AS (
         SELECT silver_calc.post_id,
            silver_calc.reaction_key,
            silver_calc.votes,
            silver_calc.bronze,
            silver_calc.silver,
            floor(silver_calc.silver::numeric / 3.0)::integer AS gold_raw
           FROM silver_calc
        )
 SELECT post_id,
    reaction_key,
    votes,
    bronze,
    silver,
    LEAST(gold_raw, 6) AS gold
   FROM gold_calc;"
public,posts_feed_stats," SELECT p.id AS post_id,
    COALESCE(c.comments_count_all, 0::bigint) AS comments_count_all,
    COALESCE(r.votes_all, 0::bigint) AS votes_all,
    COALESCE(v7.votes_7d, 0::bigint) AS votes_7d
   FROM posts p
     LEFT JOIN ( SELECT comments.post_id,
            count(*) AS comments_count_all
           FROM comments
          GROUP BY comments.post_id) c ON c.post_id = p.id
     LEFT JOIN ( SELECT post_reaction_summary.post_id,
            sum(post_reaction_summary.votes) AS votes_all
           FROM post_reaction_summary
          GROUP BY post_reaction_summary.post_id) r ON r.post_id = p.id
     LEFT JOIN ( SELECT post_reaction_votes.post_id,
            count(*) AS votes_7d
           FROM post_reaction_votes
          WHERE post_reaction_votes.created_at >= (now() - '7 days'::interval)
          GROUP BY post_reaction_votes.post_id) v7 ON v7.post_id = p.id;"
public,posts_with_counts," SELECT p.id,
    p.author_id,
    p.channel_id,
    p.format_id,
    p.title,
    p.slug,
    p.content_json,
    p.excerpt,
    p.status,
    p.published_at,
    p.created_at,
    p.updated_at,
    p.cover_image_url,
    p.cover_source,
    p.cover_meta,
    p.is_anonymous,
    p.subcategory_tag_id,
    count(DISTINCT c.id) AS comments_count,
    count(DISTINCT r.id) AS reactions_count
   FROM posts p
     LEFT JOIN comments c ON c.post_id = p.id
     LEFT JOIN post_reaction_votes r ON r.post_id = p.id
  GROUP BY p.id;"
public,profile_follow_counts," SELECT p.id AS profile_id,
    p.username,
    p.display_name,
    p.avatar_url,
    COALESCE(fol.followers_count, 0) AS followers_count,
    COALESCE(fing.following_count, 0) AS following_count
   FROM profiles p
     LEFT JOIN ( SELECT user_follows.following_id AS profile_id,
            count(*)::integer AS followers_count
           FROM user_follows
          GROUP BY user_follows.following_id) fol ON fol.profile_id = p.id
     LEFT JOIN ( SELECT user_follows.follower_id AS profile_id,
            count(*)::integer AS following_count
           FROM user_follows
          GROUP BY user_follows.follower_id) fing ON fing.profile_id = p.id;"
public,profile_medals_all_time," SELECT author_id AS profile_id,
    (pendemic_medals_reset4(sum(votes_per_post)::integer)).gold AS gold,
    (pendemic_medals_reset4(sum(votes_per_post)::integer)).silver AS silver,
    (pendemic_medals_reset4(sum(votes_per_post)::integer)).bronze AS bronze,
    sum(votes_per_post)::integer AS votes_total
   FROM ( SELECT p.author_id,
            count(v.*)::integer AS votes_per_post
           FROM posts p
             JOIN post_reaction_votes v ON v.post_id = p.id
          WHERE p.deleted_at IS NULL AND p.status = 'published'::text AND COALESCE(p.is_anonymous, false) = false
          GROUP BY p.author_id, p.id) s
  GROUP BY author_id;"
public,profile_reaction_totals," SELECT p.author_id AS profile_id,
    s.reaction_key,
    sum(s.votes)::integer AS total_votes
   FROM posts p
     JOIN post_reaction_summary s ON s.post_id = p.id
  GROUP BY p.author_id, s.reaction_key;"
public,profile_reaction_totals_labeled," SELECT t.profile_id,
    r.key AS reaction_key,
    r.label_he,
    COALESCE(t.total_votes, 0) AS total_votes,
    r.sort_order
   FROM reactions r
     LEFT JOIN profile_reaction_totals t ON t.reaction_key = r.key
  WHERE r.is_active = true;"
public,reports," SELECT id,
    reporter_id,
    reported_user_id,
    conversation_id,
    message_id,
    category,
    details,
    created_at,
    message_created_at,
    message_excerpt,
    status,
    resolved_at,
    resolved_by
   FROM user_reports;"
public,user_profile_stats," SELECT p.author_id AS user_id,
    count(DISTINCT p.id)::integer AS posts_count,
    count(v.*)::integer AS reactions_received,
    sum(s.bronze)::integer AS bronze,
    sum(s.silver)::integer AS silver,
    sum(s.gold)::integer AS gold
   FROM posts p
     LEFT JOIN post_reaction_summary s ON s.post_id = p.id
     LEFT JOIN post_reaction_votes v ON v.post_id = p.id
  GROUP BY p.author_id;"
public,user_recent_activity," SELECT v.voter_id AS user_id,
    v.created_at,
    v.reaction_key,
    p.slug AS post_slug,
    p.title AS post_title
   FROM post_reaction_votes v
     JOIN posts p ON p.id = v.post_id;"
public,user_recent_comments," SELECT c.author_id AS user_id,
    c.created_at,
    c.content,
    p.slug AS post_slug,
    p.title AS post_title
   FROM comments c
     JOIN posts p ON p.id = c.post_id;"
vault,decrypted_secrets," SELECT id,
    name,
    description,
    secret,
    convert_from(vault._crypto_aead_det_decrypt(message => decode(secret, 'base64'::text), additional => convert_to(id::text, 'utf8'::name), key_id => 0::bigint, context => '\x7067736f6469756d'::bytea, nonce => nonce), 'utf8'::name) AS decrypted_secret,
    key_id,
    nonce,
    created_at,
    updated_at
   FROM vault.secrets s;"